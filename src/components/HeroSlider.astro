---
const rawBase = import.meta.env.BASE_URL ?? '/';
const basePath = rawBase === '/' ? '' : rawBase.replace(/\/$/, '');
const withBase = (path = '') => {
  if (!path) return basePath || '/';
  return path.startsWith('/') ? `${basePath}${path}` : `${basePath}/${path}`;
};

const slides = [
  {
    id: 1,
    title: "Servicios para Empresas",
    description: "Asesoría legal integral para el crecimiento y protección de su empresa",
    image: withBase('/images/slider-1.jpg'),
    link: withBase('/servicios-empresas'),
    buttonText: "Ver Servicios Empresas"
  },
  {
    id: 2,
    title: "Servicios para Personas",
    description: "Soluciones jurídicas personalizadas para proteger sus derechos e intereses",
    image: withBase('/images/slider-2.jpg'),
    link: withBase('/servicios-personas'),
    buttonText: "Ver Servicios Personas"
  }
];
---

<section class="hero-slider relative overflow-hidden h-[700px]">
  <div class="slides-container relative w-full h-full">
    {slides.map((slide, index) => (
      <div 
        class={`slide absolute inset-0 transition-opacity duration-1000 ${index === 0 ? 'opacity-100 active' : 'opacity-0'}`}
        data-slide={index}
      >
        <!-- Background Image -->
        <div class="absolute inset-0">
          <img 
            src={slide.image} 
            alt={slide.title}
            class="w-full h-full object-cover"
          />
          <div class="absolute inset-0 bg-black/50"></div>
        </div>

        <!-- Content -->
        <div class="relative z-10 h-full flex items-center justify-center">
          <div class="slide-content max-w-container mx-auto px-6 text-center text-white">
            <h1 class="slide-title text-white text-6xl font-bold mb-6">
              {slide.title}
            </h1>
            <p class="slide-description text-white text-xl md:text-2xl mb-8 max-w-3xl mx-auto">
              {slide.description}
            </p>
            <a 
              href={slide.link}
              class="slide-cta inline-block px-8 py-4 bg-secondary text-primary font-semibold rounded-lg hover:bg-secondary-dark transition-all duration-300 hover:scale-105 shadow-lg"
            >
              {slide.buttonText}
            </a>
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- Navigation Dots -->
  <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-20 flex gap-3">
    {slides.map((_, index) => (
      <button
        class={`dot w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-white w-8' : 'bg-white/50'}`}
        data-slide-to={index}
        aria-label={`Ir al slide ${index + 1}`}
      ></button>
    ))}
  </div>

  <!-- Navigation Arrows -->
  <button 
    class="prev-slide absolute left-4 top-1/2 transform -translate-y-1/2 z-20 w-12 h-12 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white text-2xl transition-all"
    aria-label="Slide anterior"
  >
    ‹
  </button>
  <button 
    class="next-slide absolute right-4 top-1/2 transform -translate-y-1/2 z-20 w-12 h-12 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white text-2xl transition-all"
    aria-label="Siguiente slide"
  >
    ›
  </button>
</section>

<script>
  let currentSlide = 0;
  const slides = document.querySelectorAll('.slide');
  const dots = document.querySelectorAll('.dot');
  const totalSlides = slides.length;

  function showSlide(index: number) {
    // Hide all slides
    slides.forEach(slide => {
      slide.classList.remove('opacity-100', 'active');
      slide.classList.add('opacity-0');
    });

    // Update dots
    dots.forEach(dot => {
      dot.classList.remove('bg-white', 'w-8');
      dot.classList.add('bg-white/50');
    });

    // Show current slide
    slides[index].classList.remove('opacity-0');
    slides[index].classList.add('opacity-100', 'active');

    // Update current dot
    dots[index].classList.remove('bg-white/50');
    dots[index].classList.add('bg-white', 'w-8');

    currentSlide = index;
  }

  function nextSlide() {
    const next = (currentSlide + 1) % totalSlides;
    showSlide(next);
  }

  function prevSlide() {
    const prev = (currentSlide - 1 + totalSlides) % totalSlides;
    showSlide(prev);
  }

  // Auto-advance slides every 5 seconds
  let autoSlide = setInterval(nextSlide, 5000);

  // Navigation buttons
  document.querySelector('.next-slide')?.addEventListener('click', () => {
    clearInterval(autoSlide);
    nextSlide();
    autoSlide = setInterval(nextSlide, 5000);
  });

  document.querySelector('.prev-slide')?.addEventListener('click', () => {
    clearInterval(autoSlide);
    prevSlide();
    autoSlide = setInterval(nextSlide, 5000);
  });

  // Dot navigation
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      clearInterval(autoSlide);
      showSlide(index);
      autoSlide = setInterval(nextSlide, 5000);
    });
  });

  // Pause on hover
  const sliderSection = document.querySelector('.hero-slider');
  sliderSection?.addEventListener('mouseenter', () => {
    clearInterval(autoSlide);
  });

  sliderSection?.addEventListener('mouseleave', () => {
    autoSlide = setInterval(nextSlide, 5000);
  });
</script>

<style>
  .hero-slider .slide-content > * {
    opacity: 0;
    transform: translate3d(-30px, 0, 0);
  }

  .hero-slider .slide.active .slide-title {
    animation: fadeInLeft 0.8s ease forwards;
  }

  .hero-slider .slide.active .slide-description {
    animation: fadeInLeft 0.9s ease forwards;
  }

  .hero-slider .slide.active .slide-cta {
    animation: fadeInLeft 1s ease forwards;
  }

  @keyframes fadeInLeft {
    from {
      opacity: 0;
      transform: translate3d(-30px, 0, 0);
    }
    to {
      opacity: 1;
      transform: translate3d(0, 0, 0);
    }
  }
</style>
